<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Adoptions | PetVerse</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Flask-compatible static CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
  <!-- ‚úÖ Navbar -->
  <nav class="navbar">
    <div class="logo">PetVerse üêæ</div>
    <ul>
      <li><a href="{{ url_for('home') }}">Home</a></li>
      <li><a href="{{ url_for('render_page', page='pets') }}">Adopt</a></li>
      <li><a href="{{ url_for('render_page', page='volunteer') }}">Volunteer</a></li>
      <li><a href="{{ url_for('render_page', page='donate') }}">Donate</a></li>
      <li><a href="{{ url_for('render_page', page='community') }}">Community</a></li>
      <li><a href="{{ url_for('render_page', page='lost-found') }}">Lost & Found</a></li>
      <li><a href="{{ url_for('render_page', page='login') }}" id="loginLink">Login / Signup</a></li>
      <li><a href="{{ url_for('render_page', page='myadoptions') }}" style="color:var(--primary);">My Adoptions</a></li>

      <li id="logoutItem" style="display:none;">
        <a href="javascript:void(0)" id="logoutLink" style="color:var(--secondary)">Logout</a>
      </li>

      <li>
        <select id="languageSelect" onchange="changeLanguage(this.value)"
          style="background:var(--primary-light);color:white;border:none;padding:0.5rem;border-radius:var(--radius);">
          <option value="en">English</option>
          <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
          <option value="kn">‡≤ï‡≤®‡≥ç‡≤®‡≤°</option>
        </select>
      </li>
    </ul>
  </nav>

  <!-- ‚úÖ Hero Section -->
  <div class="hero">
    <h1>My Adopted Pets</h1>
    <p>View all the lovely pets you've given a forever home üè°</p>
  </div>

  <!-- ‚úÖ Adoptions Display -->
  <div id="adoptionsContainer" class="pets-grid" style="min-height:400px;text-align:center;">
    <div style="grid-column:1/-1;padding:4rem;color:var(--text-light);">
      <img src="https://cdn-icons-png.flaticon.com/512/616/616408.png" alt="No adoptions"
           style="width:200px;height:200px;opacity:0.7;margin-bottom:2rem;">
      <h3 style="font-size:1.5rem;margin-bottom:1rem;color:var(--primary);">
        Loading your adoptions...
      </h3>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast"></div>

  <!-- ‚úÖ JS Logic -->
  <script>
    function showToast(message) {
      const t = document.getElementById("toast");
      t.innerText = message;
      t.classList.add("show");
      setTimeout(() => t.classList.remove("show"), 3000);
    }

    async function loadAdoptions() {
      const user = localStorage.getItem("petpal_user");
      const container = document.getElementById('adoptionsContainer');

      if (!user) {
        container.innerHTML = `
          <div style="text-align:center;grid-column:1/-1;padding:4rem;color:var(--text-light);">
            <img src="https://cdn-icons-png.flaticon.com/512/616/616408.png" alt="Please login"
                 style="width:200px;height:200px;opacity:0.7;margin-bottom:2rem;">
            <h3 style="font-size:1.5rem;margin-bottom:1rem;color:var(--primary);">Please Login</h3>
            <p style="font-size:1.1rem;margin-bottom:2rem;">Login to view your adopted pets.</p>
            <button onclick="window.location.href='{{ url_for('render_page', page='login') }}'"
                    style="background:var(--primary);color:white;padding:0.8rem 1.5rem;
                           border-radius:var(--radius);border:none;font-weight:600;cursor:pointer;">
              Login Now
            </button>
          </div>`;
        return;
      }

      try {
        const res = await fetch(`/api/adoptions?user_name=${encodeURIComponent(user)}`);
        if (!res.ok) throw new Error("Failed to load adoptions");

        const adoptions = await res.json();

        if (adoptions.length === 0) {
          container.innerHTML = `
            <div style="text-align:center;grid-column:1/-1;padding:4rem;color:var(--text-light);">
              <img src="https://cdn-icons-png.flaticon.com/512/616/616408.png" alt="No adoptions"
                   style="width:200px;height:200px;opacity:0.7;margin-bottom:2rem;">
              <h3 style="font-size:1.5rem;margin-bottom:1rem;color:var(--primary);">No Adoptions Yet</h3>
              <p style="font-size:1.1rem;margin-bottom:2rem;">You haven't adopted any pets yet. Visit our adoption page to find your new best friend!</p>
              <button onclick="window.location.href='{{ url_for('render_page', page='pets') }}'"
                      style="background:var(--primary);color:white;padding:0.8rem 1.5rem;
                             border-radius:var(--radius);border:none;font-weight:600;cursor:pointer;">
                Browse Pets
              </button>
            </div>`;
          return;
        }

        container.innerHTML = adoptions.map(a => `
          <div class="pet-card">
            <img src="${a.image.startsWith('http') ? a.image : '/static/images/' + a.image}"
                 alt="${a.pet_name}" onerror="this.src='https://via.placeholder.com/300x200/8B5FBF/FFFFFF?text=Pet+Image'">
            <div class="pet-card-content">
              <h3>${a.pet_name}</h3>
              <span class="type">${a.type}</span>
              <p><strong>Age:</strong> ${a.age}</p>
              <p><strong>Description:</strong> ${a.description}</p>
              <div style="background:var(--background);padding:1rem;margin-top:1rem;border-radius:var(--radius);border-left:4px solid var(--accent);">
                <p><strong>Adopted by:</strong> ${a.user_name}</p>
                <p><strong>Status:</strong> üè° Happy in forever home</p>
              </div>
            </div>
          </div>
        `).join('');

      } catch (err) {
        console.error("Error fetching adoptions:", err);
        showToast("‚ö†Ô∏è Unable to load adoptions. Try again later.");
      }
    }

    function updateAuthLinks() {
      const user = localStorage.getItem("petpal_user");
      const loginLink = document.getElementById("loginLink");
      const logoutItem = document.getElementById("logoutItem");
      const logoutLink = document.getElementById("logoutLink");

      if (user) {
        loginLink.innerHTML = `Welcome, ${user} üëã`;
        loginLink.href = "javascript:void(0)";
        loginLink.onclick = () => showToast(`Already logged in as ${user}`);
        logoutItem.style.display = "block";
        logoutLink.onclick = logout;
      } else {
        logoutItem.style.display = "none";
        loginLink.innerHTML = "Login / Signup";
        loginLink.href = "{{ url_for('render_page', page='login') }}";
      }
    }

    function logout() {
      const user = localStorage.getItem("petpal_user");
      localStorage.removeItem("petpal_user");
      showToast(`Goodbye, ${user}!`);
      setTimeout(() => window.location.href = "{{ url_for('home') }}", 1500);
    }

    document.addEventListener("DOMContentLoaded", () => {
      updateAuthLinks();
      loadAdoptions();
    });
  </script>

  <!-- ‚úÖ Global Scripts -->
  <script src="{{ url_for('static', filename='header.js') }}"></script>
  <script src="{{ url_for('static', filename='chatbot_floating.js') }}"></script>

  <!-- ‚úÖ Chatbot Floating UI -->
  <div id="chatbotFloatingIcon"
       style="width:60px;height:60px;background:linear-gradient(135deg,#9b59b6,#c39bd3);
       border-radius:50%;position:fixed;bottom:25px;right:25px;
       display:none;justify-content:center;align-items:center;cursor:pointer;
       box-shadow:0 5px 15px rgba(0,0,0,0.3);z-index:9999;">
    <span style="font-size:28px;">ü§ñ</span>
  </div>

  <div id="chatbotPanel"
       style="width:350px;height:500px;background:white;border-radius:20px;
       position:fixed;bottom:100px;right:25px;display:none;
       flex-direction:column;overflow:hidden;box-shadow:0 8px 25px rgba(0,0,0,0.25);
       z-index:10000;">
    <div style="padding:15px;background:#9b59b6;color:white;display:flex;align-items:center;gap:10px;">
      <img src="https://cdn-icons-png.flaticon.com/512/620/620851.png"
           style="width:36px;height:36px;border-radius:50%;border:2px solid white;">
      <strong>PetVerse AI Assistant üêæ</strong>
    </div>
    <div id="chatMessagesAI" style="flex:1;padding:10px;overflow-y:auto;background:#f8f0ff;"></div>
    <div style="padding:10px;background:white;display:flex;gap:8px;">
      <input id="chatInputAI" type="text" placeholder="Type your message‚Ä¶"
             style="flex:1;padding:10px;border-radius:15px;border:1px solid #d5c4e6;">
      <button id="sendChatBtnAI"
              style="background:#9b59b6;color:white;border:none;padding:10px 14px;
              border-radius:14px;">‚û§</button>
    </div>
  </div>
</body>
</html>
